name: Launch python calculator web application

on:
  push:
    branches:
      - main

jobs:
  deploy:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout code
        uses: actions/checkout@v3
        with:
          repository: 'movecloud-development/python-calculator'

      - name: Copy JAR to EC2 Instance (via SSH)
        uses: appleboy/scp-action@master
        with:
          host: ${{ secrets.EC2_HOST }}  # Replace with your EC2 instance public IP or hostname
          username: ${{ secrets.EC2_USERNAME }}  # Replace with your EC2 instance username
          key: ${{ secrets.EC2_SSH_PRIVATE_KEY }}  # Replace with your EC2 instance SSH private key (base64-encoded)
          source: "/home/runner/work/python-calculator/python-calculator"
          # source: "/home/runner/work/spring-petclinic/spring-petclinic/file1.txt"
          target: "/tmp"  # Replace with the target path on the EC2 instance
          # target: "/home"
          debug: "true" 


      - name: Run Spring Application (via SSH)
        uses: appleboy/ssh-action@master
        with:
          host: ${{ secrets.EC2_HOST }}  # Replace with your EC2 instance public IP or hostname
          username: ${{ secrets.EC2_USERNAME }}  # Replace with your EC2 instance username
          key: ${{ secrets.EC2_SSH_PRIVATE_KEY }}  # Replace with your EC2 instance SSH private key (base64-encoded)
          port: 22
          script: |
            sudo cd /tmp/github/workspace
            sudo python3 -m venv env;source env/bin/activate
            sudo yum install python3-pip -y
            sudo pip3 install --upgrade pip
            sudo pip install -r requirements.txt
            sudo python app.py
          
